<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QC Flash Cards - Fixed Version</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Orbitron:wght@700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           QC FLASH CARDS - PROFESSIONAL EDITION v2.1
           Fixed: Flip functionality on all cards
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â”€â”€â”€ Design Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --bg:       #070b1a;
            --surface:  #0f1630;
            --card:     #141d38;
            --border:   #1e2d52;
            --primary:  #4f8ef7;
            --accent:   #f4c430;
            --success:  #22d472;
            --danger:   #ff4d6d;
            --text:     #e8eaf6;
            --muted:    #7b89b8;
            --radius:   20px;
            --shadow:   0 24px 60px rgba(0,0,0,0.5);
            --transition: cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        /* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *, *::before, *::after {
            margin: 0; 
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            font-family: 'DM Sans', 'Battambang', sans-serif;
            overflow-x: hidden;
        }
        
        body {
            background: var(--bg);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px 15px 40px;
            position: relative;
        }

        /* â”€â”€â”€ Animated Background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        body::before {
            content: '';
            position: fixed; 
            inset: 0;
            background:
                radial-gradient(ellipse 60% 40% at 20% 10%, rgba(79,142,247,0.12) 0%, transparent 60%),
                radial-gradient(ellipse 50% 40% at 80% 80%, rgba(244,196,48,0.07) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        /* â”€â”€â”€ Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .wrap {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 460px;
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* â”€â”€â”€ Header Brand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .brand-header {
            text-align: center;
            padding: 28px 20px 20px;
        }
        
        .brand-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(79,142,247,0.12);
            border: 1px solid rgba(79,142,247,0.3);
            border-radius: 100px;
            padding: 6px 16px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--primary);
            text-transform: uppercase;
            margin-bottom: 14px;
        }
        
        .brand-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 26px;
            font-weight: 900;
            color: var(--text);
            letter-spacing: 1px;
            line-height: 1.2;
        }
        
        .brand-title span {
            color: var(--accent);
        }
        
        .brand-sub {
            font-family: 'Battambang', sans-serif;
            font-size: 14px;
            color: var(--muted);
            margin-top: 6px;
        }

        /* â”€â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 28px 24px;
            box-shadow: var(--shadow);
        }

        /* â”€â”€â”€ Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .progress-wrap {
            margin-bottom: 20px;
        }
        
        .progress-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .progress-label {
            font-family: 'Battambang', sans-serif;
            font-size: 12px;
            color: var(--muted);
        }
        
        .progress-count {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: var(--primary);
            font-weight: 700;
        }
        
        .progress-track {
            width: 100%;
            height: 6px;
            background: var(--surface);
            border-radius: 100px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: 100px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.5s var(--transition);
        }

        /* â”€â”€â”€ Audio Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .audio-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .speak-btn {
            width: 64px;
            height: 64px;
            background: rgba(79,142,247,0.1);
            border: 2px solid rgba(79,142,247,0.35);
            border-radius: 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s var(--transition);
            position: relative;
            overflow: hidden;
        }

        .speak-btn:active {
            background: rgba(79,142,247,0.25);
            transform: scale(0.93);
        }

        .speak-btn.speaking {
            background: rgba(79,142,247,0.2);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79,142,247,0.18);
        }

        .sp-icon {
            font-size: 28px;
            transition: transform 0.2s;
        }

        .wave-bars {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 12px;
        }

        .wave-bars span {
            display: block;
            width: 3px;
            border-radius: 3px;
            background: var(--primary);
            height: 4px;
            transition: height 0.1s;
        }

        .speak-btn.speaking .wave-bars span:nth-child(1) { animation: bar 0.7s 0.0s ease-in-out infinite; }
        .speak-btn.speaking .wave-bars span:nth-child(2) { animation: bar 0.7s 0.1s ease-in-out infinite; }
        .speak-btn.speaking .wave-bars span:nth-child(3) { animation: bar 0.7s 0.2s ease-in-out infinite; }
        .speak-btn.speaking .wave-bars span:nth-child(4) { animation: bar 0.7s 0.3s ease-in-out infinite; }
        .speak-btn.speaking .wave-bars span:nth-child(5) { animation: bar 0.7s 0.15s ease-in-out infinite; }

        @keyframes bar {
            0%, 100% { height: 3px; }
            50% { height: 12px; }
        }

        /* â”€â”€â”€ Speed Control â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .speed-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .speed-lbl {
            font-family: 'Battambang', sans-serif;
            font-size: 11px;
            color: var(--muted);
        }

        .speed-toggle {
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 100px;
            overflow: hidden;
        }

        .speed-toggle button {
            padding: 4px 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            font-weight: 700;
            color: var(--muted);
            transition: all 0.2s var(--transition);
        }

        .speed-toggle button.active {
            background: var(--primary);
            color: #fff;
        }

        /* â”€â”€â”€ Flash Card Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
            CRITICAL: á‡áŸ€áŸáœá¶á„ animation conflicts
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .flashcard-container {
            perspective: 1000px;
            margin-bottom: 24px;
            min-height: 420px;
            position: relative;
        }

        .flashcard {
            position: relative;
            width: 100%;
            height: 420px;
            transform-style: preserve-3d;
            transition: transform 0.6s var(--transition);
            /* IMPORTANT: á€á»áŸ†á”áŸ’ášá¾ animation á•áŸ’áŸáŸá„á‘áŸ€áá“áŸ…á‘á¸á“áŸáŸ‡ */
        }

        /* CRITICAL FIX: Flip state */
        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden; /* Safari */
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .card-front {
            z-index: 2;
            transform: rotateY(0deg);
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, var(--surface) 0%, #0a0e1c 100%);
        }

        /* â”€â”€â”€ Card Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card-label {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(79,142,247,0.15);
            border: 1px solid rgba(79,142,247,0.3);
            border-radius: 100px;
            padding: 4px 12px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--primary);
            text-transform: uppercase;
            z-index: 10;
        }

        .card-back .card-label {
            background: rgba(244,196,48,0.15);
            border-color: rgba(244,196,48,0.3);
            color: var(--accent);
        }

        .chinese-display {
            font-size: 72px;
            font-weight: 900;
            color: var(--text);
            margin-bottom: 20px;
            line-height: 1;
            text-shadow: 0 4px 12px rgba(79,142,247,0.3);
            user-select: none;
        }

        .khmer-display {
            font-family: 'Battambang', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
            user-select: none;
        }

        .image-display {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 12px;
            margin-top: 16px;
            border: 1px solid var(--border);
        }

        /* â”€â”€â”€ Flip Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .flip-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 28px;
            background: linear-gradient(135deg, var(--primary) 0%, #6fa8ff 100%);
            border: none;
            border-radius: 100px;
            font-family: 'Battambang', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(79,142,247,0.4);
            transition: all 0.2s var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .flip-btn:hover {
            box-shadow: 0 8px 24px rgba(79,142,247,0.5);
            transform: translateX(-50%) translateY(-2px);
        }

        .flip-btn:active {
            transform: translateX(-50%) scale(0.95);
        }

        .flip-icon {
            font-size: 18px;
        }

        /* â”€â”€â”€ Navigation Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .nav-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            font-family: 'Battambang', sans-serif;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.2s var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-prev {
            background: var(--surface);
            color: var(--text);
        }

        .btn-prev:hover:not(:disabled) {
            border-color: var(--primary);
            background: rgba(79,142,247,0.08);
        }

        .btn-next {
            background: linear-gradient(135deg, var(--primary) 0%, #6fa8ff 100%);
            color: #fff;
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(79,142,247,0.3);
        }

        .btn-next:hover:not(:disabled) {
            box-shadow: 0 8px 24px rgba(79,142,247,0.4);
        }

        .btn:active:not(:disabled) {
            transform: scale(0.96);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* â”€â”€â”€ Action Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            flex: 1;
            padding: 12px;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            background: var(--surface);
            color: var(--text);
            font-family: 'Battambang', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-action:hover {
            border-color: var(--primary);
            background: rgba(79,142,247,0.08);
        }

        .btn-action:active {
            transform: scale(0.96);
        }

        /* â”€â”€â”€ Keyboard Hint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .keyboard-hint {
            text-align: center;
            padding: 16px 0 0;
            font-size: 11px;
            color: var(--muted);
            opacity: 0.6;
            font-family: 'Battambang', sans-serif;
        }

        .keyboard-hint kbd {
            display: inline-block;
            padding: 3px 8px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: 'Orbitron', monospace;
            font-size: 10px;
            font-weight: 700;
            color: var(--primary);
            margin: 0 2px;
        }

        /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .footer {
            text-align: center;
            padding: 18px 0 0;
            font-size: 11px;
            color: rgba(123,137,184,0.5);
            letter-spacing: 0.5px;
        }

        /* â”€â”€â”€ Toast Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 24px;
            font-family: 'Battambang', sans-serif;
            font-size: 14px;
            color: var(--text);
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s var(--transition);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--success);
            background: rgba(34,212,114,0.1);
            color: var(--success);
        }

        /* â”€â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .fade-in {
            animation: fadeIn 0.4s var(--transition) both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 480px) {
            .chinese-display { font-size: 60px; }
            .khmer-display { font-size: 24px; }
            .flashcard-container { min-height: 380px; }
            .flashcard { height: 380px; }
        }
    </style>
</head>
<body>
<div class="wrap">

    <!-- Brand Header -->
    <div class="brand-header">
        <div class="brand-badge">ğŸ“š FLASH CARDS</div>
        <div class="brand-title">QC<span>LEARN</span></div>
        <div class="brand-sub">ášáŸ€á“á–á¶á€áŸ’á™ QC á‡á¶á˜á½á™ Flash Cards</div>
    </div>

    <!-- Main Card -->
    <div class="card fade-in">
        
        <!-- Progress -->
        <div class="progress-wrap">
            <div class="progress-meta">
                <span class="progress-label">áœáŒáŸ’áá“á—á¶á–</span>
                <span class="progress-count" id="progressCount">1 / 49</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Audio Controls -->
        <div class="audio-controls">
            <button class="speak-btn" id="speakBtn">
                <span class="sp-icon">ğŸ”Š</span>
                <div class="wave-bars">
                    <span></span><span></span><span></span><span></span><span></span>
                </div>
            </button>
        </div>

        <!-- Speed Control -->
        <div class="speed-row">
            <span class="speed-lbl">á›áŸ’á”á¿á“:</span>
            <div class="speed-toggle" id="speedToggle">
                <button class="active" data-speed="1.0">1Ã—</button>
                <button data-speed="0.65">0.6Ã—</button>
                <button data-speed="0.45">0.4Ã—</button>
            </div>
        </div>

        <!-- Flash Card -->
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard">
                
                <!-- Front Side -->
                <div class="card-face card-front">
                    <div class="card-label">ä¸­æ–‡</div>
                    <div class="chinese-display" id="chineseText">èµ·æ³¡</div>
                    <button class="flip-btn" id="flipBtnFront">
                        <span class="flip-icon">ğŸ”„</span>
                        <span>á˜á¾á›á€á¶ášá”á€á”áŸ’ášáŸ‚</span>
                    </button>
                </div>
                
                <!-- Back Side -->
                <div class="card-face card-back">
                    <div class="card-label">á—á¶áŸá¶ááŸ’á˜áŸ‚áš</div>
                    <div class="khmer-display" id="khmerText">á–á„ / á…á¼á›ááŸ’á™á›áŸ‹</div>
                    <img class="image-display" id="cardImage" src="" alt="" style="display:none;">
                    <button class="flip-btn" id="flipBtnBack">
                        <span class="flip-icon">ğŸ”„</span>
                        <span>ááŸ’ášá¡á”áŸ‹á€áŸ’ášáŸ„á™</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <button class="btn btn-prev" id="prevBtn">â† á˜á»á“</button>
            <button class="btn btn-next" id="nextBtn">á”á“áŸ’á‘á¶á”áŸ‹ â†’</button>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn-action" id="shuffleBtn">ğŸ”€ á…áŸ’ášá”á›áŸ‹</button>
            <button class="btn-action" id="resetBtn">â†» á…á¶á”áŸ‹á•áŸ’áá¾á˜á¡á¾á„áœá·á‰</button>
        </div>

        <!-- Keyboard Hint -->
        <div class="keyboard-hint">
            <kbd>â†</kbd> <kbd>â†’</kbd> ášá»á€ášá€ &nbsp;|&nbsp; <kbd>Space</kbd> ááŸ’ášá¡á”áŸ‹
        </div>

    </div>

    <!-- Footer -->
    <div class="footer">Â© 2024 QC Flash Cards v2.1 - Fixed Edition</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT - FIXED VERSION
     Critical Fix: Flip functionality works on all cards
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
'use strict';

console.log('ğŸš€ QC Flash Cards v2.1 - FIXED EDITION');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATABASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DATABASE = [
    { cn: "èµ·æ³¡", km: "á–á„ / á…á¼á›ááŸ’á™á›áŸ‹", img: "qipao.jpg" },
    { cn: "æ ‡çº¸ä¸è‰¯", km: "ááŸ‚á˜á˜á·á“á›áŸ’á¢", img: "biaozhibuliang.jpg" },
    { cn: "ä¿®è¡¥ç—•", km: "áŸáŸ’á“á¶á˜á‡á½áŸá‡á»á›", img: "xiubuhen.jpg" },
    { cn: "æ‚è´¨", km: "á’á¼á›á¸ / á€áŸ†á‘áŸá…á€áŸ†á‘á¸", img: "zhazhi.jpg" },
    { cn: "è„æ±¡", km: "á”áŸ’ášá¡á¶á€áŸ‹", img: "zangwu.jpg" },
    { cn: "æ ‡çº¸ä½ç½®ä¸å¯¹", km: "á”á·á‘ááŸ‚á˜áá»áŸá‘á¸áá¶áŸ†á„", img: "biaozhiweizhibudui.jpg" },
    { cn: "æ ‡çº¸ä¸å¯¹ç§°", km: "á”á·á‘ááŸ‚á˜á˜á·á“áŸáŸ’á˜á¾á‚áŸ’á“á¶", img: "biaozhibuduiceng.jpg" },
    { cn: "é›¾é¢", km: "áŸáŸ’ášá¢á¶á”áŸ‹", img: "wumian.jpg" },
    { cn: "æ©˜çš®", km: "áŸáŸ†á”á€á€áŸ’ášá¼á…", img: "jupi.jpg" },
    { cn: "é’ˆå­”", km: "ášá“áŸ’á’á˜áŸ’á‡á»á›", img: "zhengkong.jpg" },
    { cn: "æ¶ˆå…‰ä¸è‰¯", km: "á‘á¹á€ááŸ’á“á¶áŸ†áŸáŸ’ášá¢á¶á”áŸ‹á˜á·á“á›áŸ’á¢", img: "xiaoguangbuliang.jpg" },
    { cn: "é˜²æ¼†ä¸è‰¯", km: "á€á¶ášá–á¶ášá‘á¹á€ááŸ’á“á¶áŸ†á˜á·á“á”á¶á“á›áŸ’á¢", img: "fangqibuliang.jpg" },
    { cn: "å·¥å‚", km: "ášáŸ„á„á…á€áŸ’áš", img: "gongchang.jpg" },
    { cn: "è½¦é—´", km: "ášáŸ„á„á‡á¶á„ / á¢á¶á‚á¶áš", img: "chejian.jpg" },
    { cn: "åŠå…¬å®¤", km: "á€á¶ášá·á™á¶á›áŸá™", img: "bangongshi.jpg" },
    { cn: "ç­é•¿", km: "á”áŸ’ášá’á¶á“á€áŸ’ášá»á˜", img: "banzhang.jpg" },
    { cn: "ç¿»è¯‘", km: "á”á€á”áŸ’ášáŸ‚", img: "fanyi.jpg" },
    { cn: "æ³¨æ„å®‰å…¨", km: "á”áŸ’ášá™áŸááŸ’á“áŸá»áœááŸ’áá·á—á¶á–", img: "zhuyianquan.jpg" },
    { cn: "ä¸Šç­", km: "á…á¼á›á’áŸ’áœá¾á€á¶áš", img: "shangban.jpg" },
    { cn: "ä¸‹ç­", km: "á…áŸá‰á–á¸á’áŸ’áœá¾á€á¶áš", img: "xiaban.jpg" },
    { cn: "è¯·å‡", km: "áŸá»áŸ†á…áŸ’á”á¶á”áŸ‹", img: "qingjia.jpg" },
    { cn: "è½¦æ¶", km: "áá½á€á„áŸ‹", img: "chejia.jpg" },
    { cn: "å‰å‰", km: "á†áŸ’á–áŸ„áŸ‡á˜á»á (Fork)", img: "qiancha.jpg" },
    { cn: "è½¦æŠŠ", km: "áŠáŸƒá€á„áŸ‹", img: "cheba.jpg" },
    { cn: "è½¦åœˆ", km: "ááŸ’á“á„á€á„áŸ‹", img: "chequan.jpg" },
    { cn: "å¤–èƒ", km: "áŸáŸ†á”á€á€á„áŸ‹", img: "waitai.jpg" },
    { cn: "è„šè¸", km: "áˆáŸ’á“á¶á“áŸ‹", img: "jiaota.jpg" },
    { cn: "é“¾æ¡", km: "á…áŸ’ášáœá¶á€áŸ‹", img: "liantiao.jpg" },
    { cn: "åº§å«", km: "á€áŸ‚á”", img: "zuodian.jpg" },
    { cn: "åˆ¹è½¦", km: "á áŸ’áœáŸ’ášá¶áŸ†á„", img: "shache.jpg" },
    { cn: "æµ‹é‡å€¼", km: "áá˜áŸ’á›áŸƒáœá¶áŸáŸ‹á‡á¶á€áŸ‹áŸáŸ’ááŸ‚á„", img: "celiangzhi.jpg" },
    { cn: "æ ‡å‡†å€¼", km: "áá˜áŸ’á›áŸƒáŸáŸ’áá„áŸ‹áŠá¶", img: "biaozhunzhi.jpg" },
    { cn: "ä¸Šé™", km: "áŠáŸ‚á“á€áŸ†áááŸ‹ á›á¾", img: "shangxian.jpg" },
    { cn: "ä¸‹é™", km: "áŠáŸ‚á“á€áŸ†áááŸ‹ á€áŸ’ášáŸ„á˜", img: "xiaxian.jpg" },
    { cn: "è¶‹åŠ¿å›¾", km: "á€áŸ’ášá¶á”á“á·á“áŸ’á“á¶á€á¶áš", img: "qushitu.jpg" },
    { cn: "åˆæ ¼", km: "á‡á¶á”áŸ‹ (OK)", img: "hege.jpg" },
    { cn: "ä¸åˆæ ¼", km: "á’áŸ’á›á¶á€áŸ‹ (NG)", img: "buhege.jpg" },
    { cn: "å¼€è£‚", km: "á”áŸ’ášáŸáŸ‡ (Crack)", img: "kailie.jpg" },
    { cn: "ç„Šç ´", km: "á•áŸ’áŸá¶á’áŸ’á›á»áŸ‡", img: "hanpo.jpg" },
    { cn: "æ¼ç„Š", km: "á—áŸ’á›áŸá…á•áŸ’áŸá¶áš", img: "louhan.jpg" },
    { cn: "é’ˆçœ¼", km: "á—áŸ’á“áŸ‚á€á˜áŸ’á‡á»á›", img: "zhenyan.jpg" },
    { cn: "å‡¹é™·", km: "á€áŸ†á–á·á / á•á", img: "aoxian.jpg" },
    { cn: "ç„Šé“åå¿ƒ", km: "á•áŸ’áŸá¶ášáœáŸ€á…", img: "handaobianxin.jpg" },
    { cn: "ç”µå‡»ä¼¤", km: "á†áŸáŸ‡á˜áŸ‰á¶áŸ", img: "dianjishang.jpg" },
    { cn: "å †ç„Š", km: "á•áŸ’áŸá¶ášá‘á¼á› (Overlap)", img: "duihan.jpg" },
    { cn: "å’¬è¾¹", km: "áŸáŸŠá¸áŸá¶á…áŸ‹á”áŸ†á–á„áŸ‹", img: "yaobian.jpg" },
    { cn: "é—´éš™", km: "á…á“áŸ’á›áŸ„áŸ‡ / á á¾á”", img: "jianxi.jpg" },
    { cn: "ç¢°åˆ®ä¼¤", km: "á”áŸ‰áŸ‡á‘á„áŸ’á‚á·á… / á€áŸ„áŸ", img: "pengguashang.jpg" },
    { cn: "ç„Šæ¸£", km: "á€áŸ†á‘áŸá…á•áŸ’áŸá¶áš", img: "hanzha.jpg" }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cards = [...DATABASE];
let currentIndex = 0;
let isFlipped = false;
let currentAudio = null;
let ttsSpeed = 1.0;
let isPlaying = false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOM ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let flashcardEl;
let chineseTextEl;
let khmerTextEl;
let cardImageEl;
let progressFillEl;
let progressCountEl;
let prevBtnEl;
let nextBtnEl;
let speakBtnEl;
let toastEl;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INITIALIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init() {
    console.log('ğŸ”§ Initializing...');
    
    // Get DOM elements
    flashcardEl = document.getElementById('flashcard');
    chineseTextEl = document.getElementById('chineseText');
    khmerTextEl = document.getElementById('khmerText');
    cardImageEl = document.getElementById('cardImage');
    progressFillEl = document.getElementById('progressFill');
    progressCountEl = document.getElementById('progressCount');
    prevBtnEl = document.getElementById('prevBtn');
    nextBtnEl = document.getElementById('nextBtn');
    speakBtnEl = document.getElementById('speakBtn');
    toastEl = document.getElementById('toast');

    // Check if elements exist
    if (!flashcardEl) {
        console.error('âŒ Flashcard element not found!');
        return;
    }

    console.log('âœ… DOM elements loaded');

    // Setup event listeners
    setupEventListeners();

    // Initial render
    updateCard();
    updateProgress();
    updateNavButtons();

    // Unlock audio
    unlockAudio();

    console.log('âœ… App initialized successfully');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT LISTENERS - CRITICAL FIX!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setupEventListeners() {
    // FLIP BUTTONS - Use event delegation
    const flipBtnFront = document.getElementById('flipBtnFront');
    const flipBtnBack = document.getElementById('flipBtnBack');
    
    if (flipBtnFront) {
        flipBtnFront.addEventListener('click', (e) => {
            e.stopPropagation();
            flipCard();
        });
    }
    
    if (flipBtnBack) {
        flipBtnBack.addEventListener('click', (e) => {
            e.stopPropagation();
            flipCard();
        });
    }

    // Navigation buttons
    if (prevBtnEl) {
        prevBtnEl.addEventListener('click', prevCard);
    }
    
    if (nextBtnEl) {
        nextBtnEl.addEventListener('click', nextCard);
    }

    // Speak button
    if (speakBtnEl) {
        speakBtnEl.addEventListener('click', playVoice);
    }

    // Speed toggle
    const speedToggle = document.getElementById('speedToggle');
    if (speedToggle) {
        speedToggle.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const speed = parseFloat(e.target.dataset.speed);
                setSpeed(speed, e.target);
            }
        });
    }

    // Action buttons
    const shuffleBtn = document.getElementById('shuffleBtn');
    const resetBtn = document.getElementById('resetBtn');
    
    if (shuffleBtn) shuffleBtn.addEventListener('click', shuffleCards);
    if (resetBtn) resetBtn.addEventListener('click', resetProgress);

    // Keyboard
    document.addEventListener('keydown', handleKeyboard);

    console.log('âœ… Event listeners attached');
}

function handleKeyboard(e) {
    switch(e.key) {
        case 'ArrowRight':
            e.preventDefault();
            nextCard();
            break;
        case 'ArrowLeft':
            e.preventDefault();
            prevCard();
            break;
        case ' ':
        case 'Enter':
            e.preventDefault();
            flipCard();
            break;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLIP CARD - CRITICAL FIX!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function flipCard() {
    if (!flashcardEl) {
        console.error('âŒ Flashcard element not found!');
        return;
    }

    // Toggle flip state
    isFlipped = !isFlipped;
    
    if (isFlipped) {
        flashcardEl.classList.add('flipped');
        console.log('ğŸ”„ Flipped to BACK');
    } else {
        flashcardEl.classList.remove('flipped');
        console.log('ğŸ”„ Flipped to FRONT');
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPDATE CARD - CRITICAL FIX!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateCard() {
    const card = cards[currentIndex];
    
    if (!card) {
        console.error('âŒ Card not found!');
        return;
    }

    console.log(`ğŸ“‡ Card ${currentIndex + 1}:`, card.cn);

    // Update content
    if (chineseTextEl) chineseTextEl.textContent = card.cn;
    if (khmerTextEl) khmerTextEl.textContent = card.km;

    // Update image
    if (cardImageEl) {
        if (card.img) {
            cardImageEl.src = card.img;
            cardImageEl.style.display = 'block';
            cardImageEl.onerror = () => {
                cardImageEl.style.display = 'none';
            };
        } else {
            cardImageEl.style.display = 'none';
        }
    }

    // CRITICAL FIX: Reset flip state
    if (flashcardEl) {
        flashcardEl.classList.remove('flipped');
        isFlipped = false;
        console.log('âœ… Flip state reset');
    }

    // Auto-play audio
    setTimeout(() => {
        playVoice();
    }, 400);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nextCard() {
    if (currentIndex >= cards.length - 1) {
        showToast('á“áŸáŸ‡á‚áºá‡á¶á€á¶áá…á»á„á€áŸ’ášáŸ„á™á á¾á™! ğŸ‰', 'success');
        return;
    }

    stopAudio();
    currentIndex++;
    updateCard();
    updateProgress();
    updateNavButtons();
}

function prevCard() {
    if (currentIndex <= 0) {
        showToast('á“áŸáŸ‡á‚áºá‡á¶á€á¶ááŠáŸ†á”á¼á„á á¾á™! ğŸ“š', 'success');
        return;
    }

    stopAudio();
    currentIndex--;
    updateCard();
    updateProgress();
    updateNavButtons();
}

function updateNavButtons() {
    if (prevBtnEl) prevBtnEl.disabled = (currentIndex === 0);
    if (nextBtnEl) nextBtnEl.disabled = (currentIndex === cards.length - 1);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateProgress() {
    const progress = ((currentIndex + 1) / cards.length) * 100;
    
    if (progressFillEl) {
        progressFillEl.style.width = `${progress}%`;
    }
    
    if (progressCountEl) {
        progressCountEl.textContent = `${currentIndex + 1} / ${cards.length}`;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function shuffleCards() {
    stopAudio();
    
    cards = [...DATABASE];
    for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
    }
    
    currentIndex = 0;
    updateCard();
    updateProgress();
    updateNavButtons();
    
    showToast('á”á¶á“á…áŸ’ášá”á›áŸ‹á€á¶áá á¾á™! ğŸ”€', 'success');
}

function resetProgress() {
    stopAudio();
    
    cards = [...DATABASE];
    currentIndex = 0;
    
    updateCard();
    updateProgress();
    updateNavButtons();
    
    showToast('á”á¶á“á…á¶á”áŸ‹á•áŸ’áá¾á˜á¡á¾á„áœá·á‰! â†»', 'success');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setSpeed(value, btnElement) {
    ttsSpeed = value;
    
    document.querySelectorAll('.speed-toggle button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    if (btnElement) {
        btnElement.classList.add('active');
    }
}

function playVoice() {
    if (isPlaying) {
        stopAudio();
        return;
    }

    const card = cards[currentIndex];
    if (!card || !card.cn) return;

    stopAudio();
    setSpeaking(true);
    isPlaying = true;

    const text = card.cn;
    const speed = Math.max(0.35, Math.min(ttsSpeed, 1.0));

    tryGoogleTTS(text, speed);
}

function tryGoogleTTS(text, speed) {
    const gttsSpeed = (speed * 0.9).toFixed(2);
    const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=zh-CN&client=gtx&ttsspeed=${gttsSpeed}`;

    const audio = new Audio(url);
    currentAudio = audio;

    audio.onended = () => {
        setSpeaking(false);
        isPlaying = false;
        currentAudio = null;
    };

    audio.onerror = () => {
        setSpeaking(false);
        isPlaying = false;
        currentAudio = null;
        useSpeechSynthesis(text, speed);
    };

    audio.play().catch(() => {
        setSpeaking(false);
        isPlaying = false;
        currentAudio = null;
        useSpeechSynthesis(text, speed);
    });
}

function useSpeechSynthesis(text, speed) {
    if (!window.speechSynthesis) return;

    window.speechSynthesis.cancel();
    setSpeaking(true);
    isPlaying = true;

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'zh-CN';
    utterance.rate = Math.max(0.3, speed * 0.85);

    const voices = window.speechSynthesis.getVoices();
    const cnVoice = voices.find(v => v.lang === 'zh-CN');
    if (cnVoice) utterance.voice = cnVoice;

    utterance.onend = () => {
        setSpeaking(false);
        isPlaying = false;
    };

    utterance.onerror = () => {
        setSpeaking(false);
        isPlaying = false;
    };

    window.speechSynthesis.speak(utterance);
}

function stopAudio() {
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
    }

    if (window.speechSynthesis) {
        window.speechSynthesis.cancel();
    }

    setSpeaking(false);
    isPlaying = false;
}

function setSpeaking(active) {
    if (!speakBtnEl) return;

    if (active) {
        speakBtnEl.classList.add('speaking');
    } else {
        speakBtnEl.classList.remove('speaking');
    }
}

function unlockAudio() {
    try {
        const silence = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=");
        silence.volume = 0;
        silence.play().catch(() => {});
    } catch(e) {}

    if (window.speechSynthesis) {
        window.speechSynthesis.getVoices();
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(message, type = 'success') {
    if (!toastEl) return;

    toastEl.textContent = message;
    toastEl.className = `toast ${type}`;

    setTimeout(() => toastEl.classList.add('show'), 10);
    setTimeout(() => toastEl.classList.remove('show'), 2500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   START APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}

</script>
</body>
</html>
